<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mermaid 示例</title>
</head>
<body>
  <h1>Mermaid 示例页面</h1>
  <p>此页面用于验证本地优先的 Mermaid 加载与 GitHub Pages 托管。</p>

  <div class="mermaid">
    flowchart TD
      A[开始] --> B{条件}
      B -->|是| C[执行步骤1]
      B -->|否| D[执行步骤2]
      C --> E[结束]
      D --> E
  </div>

  <script>
    (function () {
      function loadScript(src) {
        return new Promise(function (resolve, reject) {
          var s = document.createElement('script');
          s.src = src;
          s.onload = resolve;
          s.onerror = reject;
          document.head.appendChild(s);
        });
      }
      async function ensureMermaid() {
        var urls = [
          'vendor/mermaid.min.js',
          'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js',
          'https://unpkg.com/mermaid@10/dist/mermaid.min.js',
          'https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js'
        ];
        for (var i = 0; i < urls.length; i++) {
          try {
            await loadScript(urls[i]);
            if (window.mermaid) return window.mermaid;
          } catch (e) {}
        }
        throw new Error('Mermaid 加载失败');
      }
      document.addEventListener('DOMContentLoaded', function () {
        ensureMermaid().then(function (mer) {
          mer.initialize({ startOnLoad: false, theme: 'default' });
          var nodes = Array.prototype.slice.call(document.querySelectorAll('.mermaid'));
          try {
            mer.run({ nodes: nodes });
          } catch (e) {
            mer.init(undefined, nodes);
          }
        });
      });
    })();
  </script>
</body>
</html>
